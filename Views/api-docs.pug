extends base

block content
  main.main
    .api-docs
      .container
        h1.heading-primary.heading-primary--white.mb-large Natours API Documentation
        
        .docs-section
          h2.heading-secondary.ma-bt-md üîê Authentication Endpoints
          .endpoint-group
            .endpoint
              .endpoint__method.method--post POST
              .endpoint__url /api/v1/users/signup
              .endpoint__description Register a new user account
              .endpoint__body
                h4 Request Body:
                pre.code-block
                  | {
                  |   "name": "John Doe",
                  |   "email": "john@example.com",
                  |   "password": "password123",
                  |   "passwordConfirm": "password123"
                  | }
            
            .endpoint
              .endpoint__method.method--post POST
              .endpoint__url /api/v1/users/login
              .endpoint__description Login user and get JWT token
              .endpoint__body
                h4 Request Body:
                pre.code-block
                  | {
                  |   "email": "john@example.com",
                  |   "password": "password123"
                  | }
            
            .endpoint
              .endpoint__method.method--get GET
              .endpoint__url /api/v1/users/logout
              .endpoint__description Logout current user
              .endpoint__auth üîí Authentication required
            
            .endpoint
              .endpoint__method.method--post POST
              .endpoint__url /api/v1/users/forgotPassword
              .endpoint__description Send password reset email
              .endpoint__body
                h4 Request Body:
                pre.code-block
                  | {
                  |   "email": "john@example.com"
                  | }
            
            .endpoint
              .endpoint__method.method--patch PATCH
              .endpoint__url /api/v1/users/resetPassword/:token
              .endpoint__description Reset password with token
              .endpoint__body
                h4 Request Body:
                pre.code-block
                  | {
                  |   "password": "newPassword123",
                  |   "passwordConfirm": "newPassword123"
                  | }

        .docs-section
          h2.heading-secondary.ma-bt-md üë• User Management Endpoints
          .endpoint-group
            .endpoint
              .endpoint__method.method--get GET
              .endpoint__url /api/v1/users/me
              .endpoint__description Get current user profile
              .endpoint__auth üîí Authentication required
            
            .endpoint
              .endpoint__method.method--patch PATCH
              .endpoint__url /api/v1/users/updateMe
              .endpoint__description Update current user profile (with photo upload)
              .endpoint__auth üîí Authentication required
              .endpoint__body
                h4 Form Data (multipart/form-data):
                pre.code-block
                  | name: "Updated Name"
                  | email: "updated@example.com"
                  | photo: [file upload]
            
            .endpoint
              .endpoint__method.method--patch PATCH
              .endpoint__url /api/v1/users/updateMyPassword
              .endpoint__description Update current user password
              .endpoint__auth üîí Authentication required
              .endpoint__body
                h4 Request Body:
                pre.code-block
                  | {
                  |   "passwordCurrent": "currentPassword",
                  |   "password": "newPassword123",
                  |   "passwordConfirm": "newPassword123"
                  | }
            
            .endpoint
              .endpoint__method.method--get GET
              .endpoint__url /api/v1/users
              .endpoint__description Get all users (Admin only)
              .endpoint__auth üîí Admin access required
            
            .endpoint
              .endpoint__method.method--get GET
              .endpoint__url /api/v1/users/:id
              .endpoint__description Get specific user by ID
              .endpoint__auth üîí Admin access required

        .docs-section
          h2.heading-secondary.ma-bt-md üèîÔ∏è Tour Endpoints
          .endpoint-group
            .endpoint
              .endpoint__method.method--get GET
              .endpoint__url /api/v1/tours
              .endpoint__description Get all tours with advanced filtering, sorting, and pagination
              .endpoint__query
                h4 Query Parameters:
                pre.code-block
                  | ?page=1&limit=10&sort=-ratingsAverage,price
                  | ?fields=name,price,duration,difficulty
                  | ?price[gte]=500&price[lte]=1500
                  | ?difficulty=easy&ratingsAverage[gte]=4.5
            
            .endpoint
              .endpoint__method.method--get GET
              .endpoint__url /api/v1/tours/top-5-cheap
              .endpoint__description Get top 5 cheapest tours (pre-filtered)
            
            .endpoint
              .endpoint__method.method--get GET
              .endpoint__url /api/v1/tours/tour-stats
              .endpoint__description Get aggregated tour statistics by difficulty
            
            .endpoint
              .endpoint__method.method--get GET
              .endpoint__url /api/v1/tours/monthly-plan/:year
              .endpoint__description Get monthly tour plan for specific year
              .endpoint__auth üîí Admin/Lead-guide access required
              .endpoint__example
                h4 Example:
                pre.code-block /api/v1/tours/monthly-plan/2024
            
            .endpoint
              .endpoint__method.method--get GET
              .endpoint__url /api/v1/tours/tours-within/:distance/center/:latlng/unit/:unit
              .endpoint__description Get tours within specified distance from coordinates
              .endpoint__example
                h4 Examples:
                pre.code-block
                  | /api/v1/tours/tours-within/400/center/34.111745,-118.113491/unit/mi
                  | /api/v1/tours/tours-within/300/center/40.7128,-74.0060/unit/km
            
            .endpoint
              .endpoint__method.method--get GET
              .endpoint__url /api/v1/tours/distances/:latlng/unit/:unit
              .endpoint__description Calculate distances to all tours from specified coordinates
              .endpoint__example
                h4 Examples:
                pre.code-block
                  | /api/v1/tours/distances/34.111745,-118.113491/unit/mi
                  | /api/v1/tours/distances/51.5074,-0.1278/unit/km
            
            .endpoint
              .endpoint__method.method--get GET
              .endpoint__url /api/v1/tours/:id
              .endpoint__description Get specific tour by ID with reviews populated
            
            .endpoint
              .endpoint__method.method--post POST
              .endpoint__url /api/v1/tours
              .endpoint__description Create new tour (Admin/Lead-guide only)
              .endpoint__auth üîí Admin/Lead-guide access required
              .endpoint__body
                h4 Request Body:
                pre.code-block
                  | {
                  |   "name": "The Forest Hiker",
                  |   "duration": 5,
                  |   "maxGroupSize": 25,
                  |   "difficulty": "easy",
                  |   "ratingsAverage": 4.7,
                  |   "ratingsQuantity": 37,
                  |   "price": 397,
                  |   "summary": "Breathtaking hike through forest",
                  |   "description": "Detailed tour description...",
                  |   "startLocation": {
                  |     "type": "Point",
                  |     "coordinates": [-80.185942, 25.774772],
                  |     "address": "301 Biscayne Blvd, Miami, FL"
                  |   }
                  | }
            
            .endpoint
              .endpoint__method.method--patch PATCH
              .endpoint__url /api/v1/tours/:id
              .endpoint__description Update tour with image upload support
              .endpoint__auth üîí Admin/Lead-guide access required
              .endpoint__body
                h4 Form Data (multipart/form-data):
                pre.code-block
                  | name: "Updated Tour Name"
                  | price: 599
                  | imageCover: [file upload - cover image]
                  | images: [multiple file uploads - gallery]
                  | image: [single file - fallback for cover]
            
            .endpoint
              .endpoint__method.method--delete DELETE
              .endpoint__url /api/v1/tours/:id
              .endpoint__description Delete tour permanently
              .endpoint__auth üîí Admin/Lead-guide access required

        .docs-section
          h2.heading-secondary.ma-bt-md üí≥ Booking Endpoints
          .endpoint-group
            .endpoint
              .endpoint__method.method--get GET
              .endpoint__url /api/v1/bookings/checkout-session/:tourId
              .endpoint__description Create Stripe checkout session for tour booking
              .endpoint__auth üîí Authentication required
              .endpoint__description
                | Creates a Stripe checkout session for secure payment processing.
                | Redirects to success page after successful payment.
            
            .endpoint
              .endpoint__method.method--get GET
              .endpoint__url /api/v1/bookings
              .endpoint__description Get all bookings (with user filtering)
              .endpoint__auth üîí Authentication required
              .endpoint__description
                | Returns bookings based on user role:
                | Users see only their bookings, Admins see all bookings.
            
            .endpoint
              .endpoint__method.method--post POST
              .endpoint__url /api/v1/bookings
              .endpoint__description Create new booking manually
              .endpoint__auth üîí Authentication required
              .endpoint__body
                h4 Request Body:
                pre.code-block
                  | {
                  |   "tour": "60c72b2f9b1e8a001c8e4b8a",
                  |   "user": "60c72b2f9b1e8a001c8e4b8b",
                  |   "price": 497,
                  |   "paid": true
                  | }
            
            .endpoint
              .endpoint__method.method--get GET
              .endpoint__url /api/v1/bookings/:id
              .endpoint__description Get specific booking by ID
              .endpoint__auth üîí Authentication required
            
            .endpoint
              .endpoint__method.method--patch PATCH
              .endpoint__url /api/v1/bookings/:id
              .endpoint__description Update booking details
              .endpoint__auth üîí Authentication required
              .endpoint__body
                h4 Request Body:
                pre.code-block
                  | {
                  |   "paid": true,
                  |   "price": 550
                  | }
            
            .endpoint
              .endpoint__method.method--delete DELETE
              .endpoint__url /api/v1/bookings/:id
              .endpoint__description Cancel/delete booking
              .endpoint__auth üîí Authentication required

        .docs-section
          h2.heading-secondary.ma-bt-md ‚≠ê Review Endpoints
          .endpoint-group
            .endpoint
              .endpoint__method.method--get GET
              .endpoint__url /api/v1/reviews
              .endpoint__description Get all reviews across all tours
              .endpoint__description
                | Supports filtering, sorting, pagination like other endpoints
            
            .endpoint
              .endpoint__method.method--get GET
              .endpoint__url /api/v1/tours/:tourId/reviews
              .endpoint__description Get all reviews for specific tour
              .endpoint__description
                | Nested route that returns reviews filtered by tour ID
            
            .endpoint
              .endpoint__method.method--post POST
              .endpoint__url /api/v1/tours/:tourId/reviews
              .endpoint__description Create review for specific tour
              .endpoint__auth üîí User authentication required
              .endpoint__body
                h4 Request Body:
                pre.code-block
                  | {
                  |   "review": "Amazing experience! Highly recommend this tour.",
                  |   "rating": 5
                  | }
            
            .endpoint
              .endpoint__method.method--get GET
              .endpoint__url /api/v1/reviews/:id
              .endpoint__description Get specific review by ID
            
            .endpoint
              .endpoint__method.method--patch PATCH
              .endpoint__url /api/v1/reviews/:id
              .endpoint__description Update review (review owner only)
              .endpoint__auth üîí User authentication required (owner)
              .endpoint__body
                h4 Request Body:
                pre.code-block
                  | {
                  |   "review": "Updated review text",
                  |   "rating": 4
                  | }
            
            .endpoint
              .endpoint__method.method--delete DELETE
              .endpoint__url /api/v1/reviews/:id
              .endpoint__description Delete review (review owner only)
              .endpoint__auth üîí User authentication required (owner)

        .docs-section
          h2.heading-secondary.ma-bt-md üåê Frontend Views
          .endpoint-group
            .endpoint
              .endpoint__method.method--get GET
              .endpoint__url /
              .endpoint__description Main tours overview page
            
            .endpoint
              .endpoint__method.method--get GET
              .endpoint__url /tour/:slug
              .endpoint__description Individual tour detail page
            
            .endpoint
              .endpoint__method.method--get GET
              .endpoint__url /login
              .endpoint__description User login page
            
            .endpoint
              .endpoint__method.method--get GET
              .endpoint__url /me
              .endpoint__description User account/profile page
              .endpoint__auth üîí Authentication required
            
            .endpoint
              .endpoint__method.method--get GET
              .endpoint__url /my-tours
              .endpoint__description User's booked tours page
              .endpoint__auth üîí Authentication required

        .docs-section
          h2.heading-secondary.ma-bt-md üìä Response Format
          .endpoint-group
            .endpoint
              .endpoint__description All API responses follow this consistent structure:
              .endpoint__body
                h4 Success Response:
                pre.code-block
                  | {
                  |   "status": "success",
                  |   "results": 23,  // for arrays
                  |   "data": {
                  |     "tours": [...] // or users, reviews, bookings
                  |   }
                  | }
                h4 Error Response:
                pre.code-block
                  | {
                  |   "status": "error",
                  |   "message": "Descriptive error message",
                  |   "error": {
                  |     "name": "ValidationError",
                  |     "statusCode": 400
                  |   }
                  | }

        .docs-section
          h2.heading-secondary.ma-bt-md üîê Authentication & Authorization
          .endpoint-group
            .endpoint
              .endpoint__description
                h4 JWT Token Usage:
                pre.code-block Authorization: Bearer YOUR_JWT_TOKEN
                h4 User Roles:
                ul
                  li
                    strong user: 
                    | Can book tours, write reviews, update own profile
                  li
                    strong guide: 
                    | Tour guide with limited admin access
                  li
                    strong lead-guide: 
                    | Senior guide, can create/update tours
                  li
                    strong admin: 
                    | Full system access, user management

        .docs-section
          h2.heading-secondary.ma-bt-md üåç Geospatial Features
          .endpoint-group
            .endpoint
              .endpoint__description
                h4 Supported Coordinate Formats:
                pre.code-block
                  | Longitude,Latitude (GeoJSON format)
                  | Example: -118.113491,34.111745
                h4 Distance Units:
                ul
                  li
                    strong mi: 
                    | Miles
                  li
                    strong km: 
                    | Kilometers
                h4 Use Cases:
                ul
                  li Find tours within X miles/km of a location
                  li Calculate distances from user location to all tours
                  li Location-based tour recommendations

        .docs-section
          h2.heading-secondary.ma-bt-md ‚öôÔ∏è Advanced Features
          .endpoint-group
            .endpoint
              .endpoint__description
                h4 Query Operators:
                pre.code-block
                  | ?price[gte]=500     // Greater than or equal
                  | ?price[gt]=500      // Greater than
                  | ?price[lte]=1000    // Less than or equal
                  | ?price[lt]=1000     // Less than
                  | ?difficulty=easy    // Exact match
                h4 Sorting:
                pre.code-block
                  | ?sort=price          // Ascending
                  | ?sort=-price         // Descending
                  | ?sort=-rating,price  // Multiple fields
                h4 Field Selection:
                pre.code-block
                  | ?fields=name,price,duration  // Include only
                  | ?fields=-description        // Exclude field
                h4 Pagination:
                pre.code-block
                  | ?page=2&limit=10  // Page 2, 10 results per page

        .docs-section
          h2.heading-secondary.ma-bt-md üìã Base Information
          .endpoint-group
            .endpoint
              .endpoint__description
                h4 Base URL:
                pre.code-block http://localhost:3000
                h4 API Version:
                pre.code-block v1
                h4 Content Type:
                pre.code-block application/json
                h4 Rate Limiting:
                pre.code-block 100 requests per hour per IP
